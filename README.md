# Gemini API Pool

[ç®€ä½“ä¸­æ–‡](README.zh-CN.md)

## Overview

This project provides a lightweight, high-performance proxy server written in Rust. It exposes an OpenAI-compatible API endpoint (`/v1/chat/completions`) and intelligently routes requests to the Google Gemini API. It manages a pool of Gemini API keys, rotating them for each request to distribute the load and manage API quotas effectively.

The entire application is containerized with Docker for easy, one-click deployment.

PS: The entire application is generated by Claude Code except this line, feel free to use it.

## Features

- **OpenAI API Compatibility**: Drop-in replacement for services that use the OpenAI Chat Completions API format.
- **API Key Management**: Dynamic creation, editing, and deletion of API keys with usage tracking.
- **Web Management Interface**: Modern, tech-styled web dashboard for managing API keys and monitoring usage.
- **Usage Analytics**: Real-time tracking of requests, input/output tokens, and API key statistics.
- **Secure Authentication**: JWT-based admin authentication with role-based access control.
- **API Key Rotation**: Automatically rotates Gemini API keys from a predefined pool on each request.
- **Dynamic Model Selection**: Uses the `model` field from the request payload to target different Gemini models (e.g., `gemini-1.5-flash`, `gemini-1.5-pro`).
- **High Performance**: Built with Rust and Axum for asynchronous, fast, and reliable performance.
- **Easy Deployment**: One-command deployment using Docker and a simple shell script.
- **Database Storage**: SQLite database for persistent storage of API keys and usage logs.

## Prerequisites

- [Docker](https://www.docker.com/get-started)
- [Git](https://git-scm.com/downloads)

## Getting Started

### 1. Clone the Repository

```bash
git clone https://github.com/cod3vil/gemini-pool.git
cd gemini-pool
```

### 2. Configuration

The application requires a `.env` file to store your Gemini API keys.

1.  **Create the `.env` file** by copying the provided example:
    ```bash
    cp gemini-pool/.env.example gemini-pool/.env
    ```

2.  **Edit `gemini-pool/.env`** and configure the required settings:

    ```dotenv
    # gemini-pool/.env

    # Put your Gemini API keys here, separated by commas.
    GEMINI_API_KEYS=your_key_1,your_key_2,your_key_3

    # Admin authentication for web management interface
    ADMIN_USERNAME=admin
    ADMIN_PASSWORD=your_secure_admin_password

    # JWT secret for admin session management (change this in production)
    JWT_SECRET=your_jwt_secret_change_in_production

    # Database URL (SQLite by default)
    DATABASE_URL=sqlite:./gemini_pool.db

    # The address to bind the server to (inside the container).
    # This must be 0.0.0.0:8080 to be accessible from the host via Docker.
    LISTEN_ADDR=0.0.0.0:8080
    ```

### 3. Deployment with Docker (Recommended)

The included `deploy.sh` script handles everything from building the Docker image to running the container.

1.  **Make the script executable**:
    ```bash
    chmod +x deploy.sh
    ```

2.  **Run the script**:
    - To run on the default port `8080`:
      ```bash
      ./deploy.sh
      ```
    - To run on a custom port (e.g., `9000`):
      ```bash
      ./deploy.sh 9000
      ```

The script will build the image, stop any old containers, and start a new one in the background.

- **To view logs**: `docker logs -f gemini-pool-container`
- **To stop the service**: `docker stop gemini-pool-container`

## Web Management Interface

After deployment, you can access the web management interface to manage API keys and monitor usage:

### Accessing the Dashboard

1. **Login Page**: Navigate to `http://127.0.0.1:8080/login.html`
2. **Use your admin credentials** (from your `.env` file)
3. **Access the management dashboard** at `http://127.0.0.1:8080/management.html`

### Features

- **ðŸŽ¨ Modern Tech-Styled Interface**: Cyberpunk-inspired design with matrix rain background effects
- **ðŸ“Š Real-time Dashboard**: View total API keys, requests, tokens, and active keys
- **ðŸ”‘ API Key Management**: 
  - Create new API keys (auto-generated or custom)
  - Edit key names and toggle active status
  - Delete unused keys
  - View detailed usage statistics per key
- **ðŸ“ˆ Usage Analytics**: Track input/output tokens and request counts
- **ðŸ”’ Secure Authentication**: JWT-based session management
- **ðŸ“± Responsive Design**: Works on desktop and mobile devices

### Client API Key Authentication

When using the API endpoints (`/v1/chat/completions`, `/v1/models`), clients must include an API key created through the web interface:

```bash
curl -X POST http://127.0.0.1:8080/v1/chat/completions \
-H "Content-Type: application/json" \
-H "Authorization: Bearer your_client_api_key" \
-d '{...}'
```

## API Usage

Send a POST request to the `/v1/chat/completions` endpoint. The request body should be in the OpenAI Chat Completions format.

### Example Request

Here is an example using `curl` to interact with the service. You can specify any supported Gemini model in the `model` field.

```bash
curl -X POST http://127.0.0.1:8080/v1/chat/completions \
-H "Content-Type: application/json" \
-H "Authorization: Bearer your_client_api_key" \
-d '{
  "model": "gemini-1.5-flash",
  "messages": [
    {
      "role": "system",
      "content": "You are a helpful assistant."
    },
    {
      "role": "user",
      "content": "Hello! What is the capital of France?"
    }
  ]
}'
```

**Note**: Replace `your_client_api_key` with an API key created through the web management interface.

The server will forward this request to the Gemini API using one of your keys and return a response in the OpenAI format.

### List Models

To see the list of available models supported by this proxy, send a GET request to the `/v1/models` endpoint.

```bash
curl -H "Authorization: Bearer your_client_api_key" \
     http://127.0.0.1:8080/v1/models
```
